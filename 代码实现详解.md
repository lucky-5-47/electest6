# ä»£ç å®ç°è¯¦è§£ - å¦‚ä½•å†™æˆè¿™äº›åŠŸèƒ½

## 1ï¸âƒ£ å¯¹è¯æ¡†æ‹–æ‹½åŠŸèƒ½çš„å®Œæ•´å®ç°

### æ ¸å¿ƒåŸç†
```
ç”¨æˆ·æŒ‰ä¸‹é¼ æ ‡ â†’ è®°å½•åˆå§‹ä½ç½® â†’ ç§»åŠ¨é¼ æ ‡ â†’ è®¡ç®—ç§»åŠ¨è·ç¦» â†’ æ›´æ–°å¯¹è¯æ¡†ä½ç½® â†’ æ¾å¼€é¼ æ ‡ â†’ åœæ­¢æ‹–æ‹½
```

### å®Œæ•´ä»£ç ç¤ºä¾‹

```javascript
// ç¬¬1æ­¥ï¼šåˆ›å»ºå¯¹è¯æ¡†
const dialog = document.createElement('div');
dialog.style.cssText = `
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 10000;
    width: 800px;
    height: 600px;
`;

// ç¬¬2æ­¥ï¼šåˆå§‹åŒ–ä½ç½®ï¼ˆé‡è¦ï¼ï¼‰
const initialRect = dialog.getBoundingClientRect();
dialog.style.left = initialRect.left + 'px';
dialog.style.top = initialRect.top + 'px';
dialog.style.transform = 'none';  // æ¸…é™¤transform

// ç¬¬3æ­¥ï¼šå®šä¹‰æ‹–æ‹½å˜é‡
let isDragging = false;
let startX = 0, startY = 0;
let elementX = 0, elementY = 0;

// ç¬¬4æ­¥ï¼šé¼ æ ‡æŒ‰ä¸‹äº‹ä»¶
dialogHeader.addEventListener('mousedown', (e) => {
    // æ£€æŸ¥æ˜¯å¦ç‚¹å‡»å…³é—­æŒ‰é’®
    if (e.target.classList.contains('dialog-close')) {
        return;  // ä¸å¯åŠ¨æ‹–æ‹½
    }
    
    isDragging = true;
    startX = e.clientX;      // è®°å½•é¼ æ ‡Xåæ ‡
    startY = e.clientY;      // è®°å½•é¼ æ ‡Yåæ ‡
    
    const rect = dialog.getBoundingClientRect();
    elementX = rect.left;    // è®°å½•å¯¹è¯æ¡†å·¦è¾¹è·ç¦»
    elementY = rect.top;     // è®°å½•å¯¹è¯æ¡†é¡¶éƒ¨è·ç¦»
    
    dialogHeader.style.cursor = 'grabbing';
    e.preventDefault();
});

// ç¬¬5æ­¥ï¼šé¼ æ ‡ç§»åŠ¨äº‹ä»¶
const dragMove = (e) => {
    if (!isDragging) return;
    
    // è®¡ç®—é¼ æ ‡ç§»åŠ¨è·ç¦»
    const deltaX = e.clientX - startX;
    const deltaY = e.clientY - startY;
    
    // è®¡ç®—æ–°ä½ç½®
    const newX = elementX + deltaX;
    const newY = elementY + deltaY;
    
    // é™åˆ¶åœ¨å±å¹•èŒƒå›´å†…
    const maxX = window.innerWidth - dialog.offsetWidth;
    const maxY = window.innerHeight - dialog.offsetHeight;
    
    const constrainedX = Math.max(0, Math.min(newX, maxX));
    const constrainedY = Math.max(0, Math.min(newY, maxY));
    
    // æ›´æ–°å¯¹è¯æ¡†ä½ç½®
    dialog.style.left = constrainedX + 'px';
    dialog.style.top = constrainedY + 'px';
};

// ç¬¬6æ­¥ï¼šé¼ æ ‡æ¾å¼€äº‹ä»¶
const dragEnd = () => {
    isDragging = false;
    dialogHeader.style.cursor = 'move';
};

// ç¬¬7æ­¥ï¼šæ³¨å†Œäº‹ä»¶ç›‘å¬
dialogHeader.addEventListener('mousedown', () => {
    document.addEventListener('mousemove', dragMove);
    document.addEventListener('mouseup', dragEnd);
});

// ç¬¬8æ­¥ï¼šå…³é—­æ—¶æ¸…ç†äº‹ä»¶
dialog.querySelector('.dialog-close').addEventListener('click', () => {
    document.removeEventListener('mousemove', dragMove);
    document.removeEventListener('mouseup', dragEnd);
    document.body.removeChild(dialog);
});
```

### å…³é”®ç‚¹è¯´æ˜

1. **ä¸ºä»€ä¹ˆè¦æ¸…é™¤transformï¼Ÿ**
   - åˆå§‹åŒ–æ—¶ç”¨ `transform: translate(-50%, -50%)` å±…ä¸­
   - æ‹–æ‹½æ—¶éœ€è¦ç”¨ `left/top` å®šä½
   - ä¸¤ç§æ–¹å¼æ··ç”¨ä¼šå¯¼è‡´åæ ‡æ··ä¹±

2. **ä¸ºä»€ä¹ˆè¦è®°å½•åˆå§‹ä½ç½®ï¼Ÿ**
   - `getBoundingClientRect()` è·å–å®é™…åƒç´ ä½ç½®
   - ç”¨äºè®¡ç®—ç›¸å¯¹ç§»åŠ¨è·ç¦»

3. **ä¸ºä»€ä¹ˆè¦é™åˆ¶åœ¨å±å¹•èŒƒå›´å†…ï¼Ÿ**
   - é˜²æ­¢å¯¹è¯æ¡†æ‹–å‡ºå±å¹•å¤–
   - æå‡ç”¨æˆ·ä½“éªŒ

---

## 2ï¸âƒ£ æ•°æ®åˆ†é…å™¨åˆ†ç±»çš„å®ç°

### HTMLç»“æ„

```html
<!-- åŸºç¡€ç»“æ„ -->
<li>
    <details>
        <summary>æ•°æ®åˆ†é…å™¨</summary>
        <ul style="margin-left: 20px;">
            <li data-type="74ls138">74LS138 1è·¯-8è·¯</li>
            <li data-type="74139">74LS139 1è·¯-4è·¯</li>
        </ul>
    </details>
</li>
```

### å¦‚ä½•æ·»åŠ æ–°åˆ†ç±»

```html
<!-- ç¤ºä¾‹ï¼šæ·»åŠ "è®¡æ•°å™¨"åˆ†ç±» -->
<li>
    <details>
        <summary>è®¡æ•°å™¨</summary>
        <ul style="margin-left: 20px;">
            <li data-type="74ls160">74LS160 åŒæ­¥è®¡æ•°å™¨</li>
            <li data-type="74ls161">74LS161 åŒæ­¥è®¡æ•°å™¨</li>
            <li data-type="mod-n-counter">æ¨¡Nè®¡æ•°å™¨</li>
        </ul>
    </details>
</li>
```

### JavaScriptå¤„ç†

```javascript
// ç‚¹å‡»æ—¶è‡ªåŠ¨å±•å¼€/æŠ˜å 
document.querySelectorAll('details').forEach(detail => {
    detail.addEventListener('click', (e) => {
        // detailså…ƒç´ è‡ªåŠ¨å¤„ç†å±•å¼€/æŠ˜å 
        // æ— éœ€é¢å¤–ä»£ç 
    });
});

// ç‚¹å‡»å­é¡¹æ—¶åˆ›å»ºç»„ä»¶
document.querySelectorAll('li[data-type]').forEach(li => {
    li.addEventListener('click', (e) => {
        const type = li.dataset.type;
        createComponentFromSidebar(type);
    });
});
```

---

## 3ï¸âƒ£ è“è‰²é€‰ä¸­æ–¹æ¡†çš„å®ç°

### æ ¸å¿ƒä»£ç 

```javascript
// é€‰æ‹©ç»„ä»¶
function selectComponent(component) {
    selectedComponents.add(component);
    
    // è®¾ç½®è“è‰²è¾¹æ¡†
    component.style.outline = '2px solid #007bff';
    
    // è¾¹æ¡†å‘å†…ç¼©è¿›20px
    component.style.outlineOffset = '-20px';
}

// å–æ¶ˆé€‰æ‹©
function deselectComponent(component) {
    selectedComponents.delete(component);
    component.style.outline = '';
    component.style.outlineOffset = '';
}
```

### å±æ€§è¯¦è§£

```javascript
// outline: è¾¹æ¡†æ ·å¼
// æ ¼å¼: [å®½åº¦] [æ ·å¼] [é¢œè‰²]
component.style.outline = '2px solid #007bff';
//                         â†‘    â†‘     â†‘
//                        å®½åº¦  æ ·å¼  é¢œè‰²

// outlineOffset: è¾¹æ¡†è·ç¦»
// æ­£å€¼ï¼šå‘å¤–æ‰©å±•
// è´Ÿå€¼ï¼šå‘å†…æ”¶ç¼©
component.style.outlineOffset = '-20px';
//                               â†‘
//                          å‘å†…ç¼©è¿›20px
```

### è‡ªå®šä¹‰æ–¹æ¡†å¤§å°

```javascript
// æ–¹æ¡ˆ1ï¼šæ”¹å˜è¾¹æ¡†å®½åº¦
component.style.outline = '3px solid #007bff';  // æ›´ç²—

// æ–¹æ¡ˆ2ï¼šæ”¹å˜å†…ç¼©è·ç¦»
component.style.outlineOffset = '-25px';  // æ›´ç´§è´´

// æ–¹æ¡ˆ3ï¼šæ”¹å˜é¢œè‰²
component.style.outline = '2px solid #FF0000';  // çº¢è‰²

// æ–¹æ¡ˆ4ï¼šç»„åˆä¿®æ”¹
component.style.outline = '3px solid #00FF00';
component.style.outlineOffset = '-15px';
```

---

## 4ï¸âƒ£ å®Œæ•´çš„æ–°å®éªŒåˆ›å»ºæµç¨‹

### æ­¥éª¤1ï¼šåˆ›å»ºSVGç»„ä»¶æ–‡ä»¶ (æ–°ç»„ä»¶.js)

```javascript
// å®šä¹‰SVGæ¨¡æ¿
const newComponentSvg = {
    'new-component': `
        <svg class="component-svg" viewBox="0 0 200 200">
            <rect x="50" y="50" width="100" height="100" fill="#E8F4FD"/>
            <text x="100" y="105" text-anchor="middle">æ–°ç»„ä»¶</text>
        </svg>
    `
};

// å®šä¹‰é€»è¾‘å‡½æ•°
const newComponentLogic = {
    'new-component': (inputs) => {
        // å¤„ç†è¾“å…¥ï¼Œè¿”å›è¾“å‡º
        return { output: inputs.input };
    }
};

// åˆå§‹åŒ–å‡½æ•°
function initializeNewComponent(componentDiv, type) {
    componentDiv.title = 'æ–°ç»„ä»¶ - åŒå‡»æŸ¥çœ‹è¯´æ˜';
    componentDiv.addEventListener('dblclick', showNewComponentDialog);
}

// å¯¹è¯æ¡†å‡½æ•°
function showNewComponentDialog() {
    const dialog = document.createElement('div');
    dialog.style.cssText = `
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 10000;
        width: 800px;
        height: 600px;
    `;
    
    dialog.innerHTML = `
        <div style="width: 100%; height: 100%; background: white; 
                    border: 2px solid #333; display: flex; flex-direction: column;">
            <div style="background: #2196F3; color: white; padding: 15px 20px; 
                        cursor: move; display: flex; justify-content: space-between;">
                <h2>æ–°ç»„ä»¶è¯´æ˜</h2>
                <button onclick="this.closest('div').parentElement.remove()">Ã—</button>
            </div>
            <div style="padding: 20px; overflow-y: auto; flex: 1;">
                <h3>åŠŸèƒ½è¯´æ˜</h3>
                <p>è¿™æ˜¯ä¸€ä¸ªæ–°ç»„ä»¶çš„è¯´æ˜...</p>
            </div>
        </div>
    `;
    
    document.body.appendChild(dialog);
    // æ·»åŠ æ‹–æ‹½åŠŸèƒ½...
}

// æš´éœ²åˆ°å…¨å±€
window.newComponent = {
    initialize: initializeNewComponent,
    svg: newComponentSvg,
    logic: newComponentLogic
};
```

### æ­¥éª¤2ï¼šåœ¨merged_complete.htmlä¸­å¼•å…¥

```html
<!-- åœ¨<head>ä¸­æ·»åŠ  -->
<script src="æ–°ç»„ä»¶.js"></script>
```

### æ­¥éª¤3ï¼šåœ¨å®éªŒåˆ—è¡¨ä¸­æ·»åŠ 

```html
<!-- åœ¨ç¬¬515-523è¡Œçš„æ•°æ®åˆ†é…å™¨åæ·»åŠ  -->
<li data-type="new-component">æ–°ç»„ä»¶åç§°</li>
```

### æ­¥éª¤4ï¼šæ³¨å†Œç»„ä»¶

```javascript
// åœ¨merged_complete.htmlçš„åˆå§‹åŒ–ä»£ç ä¸­æ·»åŠ 
if (window.newComponent && window.newComponent.svg) {
    componentSvgs['new-component'] = window.newComponent.svg['new-component'];
    logicFunctions['new-component'] = window.newComponent.logic['new-component'];
}
```

---

## ğŸ“ æ€»ç»“

| åŠŸèƒ½ | æ ¸å¿ƒä»£ç  | å…³é”®ç‚¹ |
|------|---------|--------|
| æ‹–æ‹½ | `getBoundingClientRect()` + `left/top` | æ¸…é™¤transform |
| åˆ†ç±» | `<details>` + `<ul>` | data-typeå±æ€§ |
| æ–¹æ¡† | `outline` + `outlineOffset` | è´Ÿå€¼å‘å†…ç¼© |
| æ–°ç»„ä»¶ | SVG + é€»è¾‘å‡½æ•° + åˆå§‹åŒ– | å…¨å±€æ³¨å†Œ |

