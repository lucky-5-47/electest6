# 74LS138和74LS153逻辑实现流程图

## 1️⃣ 74LS138 (3线-8线译码器) 完整流程

### 输入处理流程
```
输入信号
├── A2 (地址位2)
├── A1 (地址位1)
├── A0 (地址位0)
├── G1 (使能1，高电平有效)
├── G2A (使能2A，低电平有效)
└── G2B (使能2B，低电平有效)
    ↓
转换为数字类型
    ↓
检查使能条件：G1=1 && G2A=0 && G2B=0
    ├─ 条件不满足 → 所有输出=1 → 返回
    └─ 条件满足 ↓
计算地址：(A2<<2) | (A1<<1) | A0
    ↓
地址值 (0-7)
    ├─ 0 → Y0=0, 其他=1
    ├─ 1 → Y1=0, 其他=1
    ├─ 2 → Y2=0, 其他=1
    ├─ 3 → Y3=0, 其他=1
    ├─ 4 → Y4=0, 其他=1
    ├─ 5 → Y5=0, 其他=1
    ├─ 6 → Y6=0, 其他=1
    └─ 7 → Y7=0, 其他=1
    ↓
输出8个信号 (Y0-Y7)
```

### 真值表示例

**例1：使能，地址=3**
```
输入：G1=1, G2A=0, G2B=0, A2=0, A1=1, A0=1
地址计算：(0<<2)|(1<<1)|1 = 0|2|1 = 3
输出：Y0=1, Y1=1, Y2=1, Y3=0, Y4=1, Y5=1, Y6=1, Y7=1
```

**例2：禁用，G1=0**
```
输入：G1=0, G2A=0, G2B=0, A2=0, A1=0, A0=0
使能条件：0 && 0 && 0 = false
输出：Y0=1, Y1=1, Y2=1, Y3=1, Y4=1, Y5=1, Y6=1, Y7=1
```

---

## 2️⃣ 74LS153 (4选1数据选择器) 完整流程

### 输入处理流程
```
输入信号
├── D0 (数据输入0)
├── D1 (数据输入1)
├── D2 (数据输入2)
├── D3 (数据输入3)
├── A0 (地址位0)
├── A1 (地址位1)
└── S̄ (使能，低电平有效)
    ↓
检查使能条件：S̄=0
    ├─ S̄=1 (禁用) → 输出Y=0 → 返回
    └─ S̄=0 (使能) ↓
计算地址：(A1<<1) | A0
    ↓
地址值 (0-3)
    ├─ 0 → Y = D0
    ├─ 1 → Y = D1
    ├─ 2 → Y = D2
    └─ 3 → Y = D3
    ↓
输出1个信号 (Y)
```

### 真值表示例

**例1：使能，地址=2，D2=1**
```
输入：S̄=0, A1=1, A0=0, D0=0, D1=0, D2=1, D3=0
地址计算：(1<<1)|0 = 2|0 = 2
输出：Y = D2 = 1
```

**例2：禁用，S̄=1**
```
输入：S̄=1, A1=0, A0=0, D0=1, D1=1, D2=1, D3=1
使能条件：S̄=1 (禁用)
输出：Y = 0
```

---

## 3️⃣ 系统中的信号传播流程

### 完整的信号传播链

```
用户操作（按按钮、改变开关）
    ↓
触发事件处理器
    ↓
更新组件状态：componentStates.set(id, value)
    ↓
调用 propagateSignal(component)
    ↓
获取组件的所有输出锚点
    ↓
对每个输出锚点：
    ├─ 查找连接的目标锚点
    ├─ 获取目标组件
    ├─ 获取目标组件的类型
    └─ 根据类型处理 ↓
        ├─ 如果是 74LS138 ↓
        │   ├─ 调用 get74LS138InputStates()
        │   ├─ 调用 logicFunctions['74ls138'](inputs)
        │   ├─ 保存输出状态
        │   └─ 继续 propagateSignal()
        │
        ├─ 如果是 74LS153 ↓
        │   ├─ 调用 get74LS153InputStates()
        │   ├─ 调用 logicFunctions['74ls153'](inputs)
        │   ├─ 保存输出状态
        │   ├─ 更新显示
        │   └─ 继续 propagateSignal()
        │
        └─ 如果是其他组件
            └─ 相应处理...
    ↓
信号传播完成
```

---

## 4️⃣ 代码执行顺序

### 74LS138 信号处理顺序

```
1. propagateSignal(74LS138组件) 被调用
   ↓
2. 获取74LS138的所有输出锚点 (Y0-Y7)
   ↓
3. 对每个输出锚点，查找连接的目标
   ↓
4. 对于每个连接的目标组件：
   ├─ 获取目标组件类型
   ├─ 调用 get74LS138InputStates(74LS138组件)
   │   ├─ 遍历所有输入锚点 (A0, A1, A2, G1, G2A, G2B)
   │   ├─ 对每个输入锚点，查找连接的信号源
   │   ├─ 获取信号源的输出值
   │   └─ 返回 {A0: ?, A1: ?, A2: ?, G1: ?, G2A: ?, G2B: ?}
   │
   ├─ 调用 logicFunctions['74ls138'](inputs)
   │   ├─ 检查使能条件
   │   ├─ 计算地址
   │   ├─ 根据地址设置输出
   │   └─ 返回 {Y0: ?, Y1: ?, ..., Y7: ?}
   │
   ├─ 保存输出状态：componentStates.set(id, outputState)
   │
   └─ 继续传播：propagateSignal(74LS138组件)
```

### 74LS153 信号处理顺序

```
1. propagateSignal(74LS153组件) 被调用
   ↓
2. 获取74LS153的所有输出锚点 (Y)
   ↓
3. 对每个输出锚点，查找连接的目标
   ↓
4. 对于每个连接的目标组件：
   ├─ 获取目标组件类型
   ├─ 调用 get74LS153InputStates(74LS153组件)
   │   ├─ 遍历所有输入锚点 (D0, D1, D2, D3, A0, A1, S)
   │   ├─ 对每个输入锚点，查找连接的信号源
   │   ├─ 获取信号源的输出值
   │   └─ 返回 {D0: ?, D1: ?, D2: ?, D3: ?, A0: ?, A1: ?, S: ?}
   │
   ├─ 调用 logicFunctions['74ls153'](inputs)
   │   ├─ 检查使能条件 (S=0)
   │   ├─ 计算地址
   │   ├─ 根据地址选择数据
   │   └─ 返回 {Y: ?}
   │
   ├─ 保存输出状态：componentStates.set(id, outputState)
   │
   ├─ 更新显示：updateLS153Display(74LS153组件)
   │
   └─ 继续传播：propagateSignal(74LS153组件)
```

---

## 5️⃣ 关键数据结构

### componentStates (组件状态存储)

```javascript
// 74LS138 的状态
componentStates.set('ls138-1', {
    Y0: 1, Y1: 1, Y2: 1, Y3: 1,
    Y4: 1, Y5: 1, Y6: 1, Y7: 1
});

// 74LS153 的状态
componentStates.set('ls153-1', {
    Y: 0
});
```

### logicFunctions (逻辑函数映射)

```javascript
logicFunctions = {
    '74ls138': (inputs) => { ... },
    '74ls153': (inputs) => { ... },
    'and-gate': (inputs) => { ... },
    // ... 其他逻辑函数
};
```

### anchorConnections (锚点连接映射)

```javascript
// 存储哪些锚点连接到哪些锚点
anchorConnections.set(sourceAnchor, [targetAnchor1, targetAnchor2, ...]);
```

---

## 6️⃣ 调试技巧

### 查看控制台日志

```javascript
// 74LS138 的日志
console.log('74LS138输入:', { A2, A1, A0, G1, G2A, G2B });
console.log('使能条件:', enableCondition);
console.log('选择的输出线:', selectedOutput);
console.log('74LS138输出:', outputs);

// 74LS153 的日志
console.log('74LS153逻辑计算 - 输入:', inputs);
console.log(`地址${address} -> 选择D${address}=${Y}`);
console.log(`74LS153最终输出: Y=${Y}`);
```

### 在浏览器中测试

```javascript
// 打开浏览器控制台 (F12)
// 测试74LS138逻辑函数
const result = logicFunctions['74ls138']({
    A2: 1, A1: 0, A0: 1,
    G1: 1, G2A: 0, G2B: 0
});
console.log(result);  // 应该输出 {Y0:1, Y1:1, ..., Y5:0, ...}

// 测试74LS153逻辑函数
const result = logicFunctions['74ls153']({
    D0: 0, D1: 1, D2: 0, D3: 1,
    A0: 1, A1: 0, S: 0
});
console.log(result);  // 应该输出 {Y: 1}
```

